# 核心概念

**AZ：**Availability Zone可用区

**AZ逃生：**当一个AZ整体不可用时，系统可以自动快速切换到其他AZ，业务不中断

**服务发现与治理平台：**管控公司的所有服务（http服务、rpc服务、数据库服务、消息队列服务）的名称与ip实例映射。

> 每个服务都有自己的ip地址，如果采用静态配置写死每个服务的ip，那么会导致如下情况：
>
> 1. 机器重启，导致ip改变，原先应用写死的服务ip不生效，从而使得应用瘫痪；
> 2. 服务的实例挂了，流量依旧往这个实例上打，不能实现限流熔断、负载均衡；
>
> 对于情况1采用配置服务名的方式，一个服务先在平台中注册，调用方向调用平台对应服务，平台就可用实例的ip返回给调用方。使用动态ip配置的方式解决了静态配置写死ip的问题
>
> 对于情况2采用集群的方式，一个服务有多个实例，当某个服务的主库实例挂了后，让其他可用从库实例充当主库。使用集群多实例的方式解决了单实例的问题
>
> 所以公司一般需要建立服务发现与治理平台，采样集群多实例方式进管理。

平台的治理功能体现在如下，主要是对流量的控制上。

健康检查：哪个实例挂了就别用了

负载均衡：请求别全打到一个实例

熔断：对方快挂了，先别打

限流：防止被流量打死

灰度发布：新版本只给一部分人使用



# 数据库管理

**集群、多AZ、主从库的方式管理：**多台数据库节点，通过协议进行分工，对外表现为一个数据库。主库唯一负责写入，处理写请求；从库从主库复制数据，负责读取，处理读请求，分担主库的压力

**连接数据库：**公司封装的ORM负责根据当前环境、数据库服务名从服务发现与治理平台中获取到健康实例的信息，使用它们组装成底层ORM需要的连接配置建立连接池。对开发者暴露出环境、服务名接口即可连接到实际数据库

